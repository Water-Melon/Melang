### Network

This document introduces a set of functions about TCP and UDP in Melang.



##### mln_tcp_connect

create a TCP connection to server.

```
@mln_tcp_connect(host, service, timeout);
```

Input:

- host - a string value. It can be an IP or domain name.
- service -  a string value. It can be a port number or protocol name, like: http, 80.
- timeout - a millisecond timer. It's an optional argument. It must be an positive integer or zero (timeout immediately). Omit means never timeout.

Return value:

- a TCP socket file descriptor return on success
- *nil* on timed out
- otherwise *false* returned



##### mln_tcp_listen

Set up a TCP listen socket.

```
@mln_tcp_listen(host, service);
```

Input:

- host - a string value. It can be an IP or domain name.
- service -  a string value. It can be a port number or protocol name, like: http, 80.

Return value:

- a TCP socket file descriptor return on success, otherwise *false* returned.



##### mln_tcp_accept

Accept a TCP connection.

```
@mln_tcp_accept(listenfd, timeout);
```

Input:

- listened - an integer value generated by *mln_tcp_listen*.
- timeout - a millisecond timer. It's an optional argument. It must be an positive integer or zero (timeout immediately). Omit means never timeout.

Return value:

- a TCP socket file descriptor return on success.
- If *timeout* >= 0 and no TCP arrived, *nil* will be returned.
- Otherwise, *false* returned.



##### mln_tcp_send

Send 'data' via TCP.

```
@mln_tcp_send(sockfd, data);
```

Input:

- socked - a socket file descriptor which is an integer.
- data - a string value.

Return value:

- *true* returned on success, otherwise *false* returned.



##### mln_tcp_recv

Receive data from TCP.

```
@mln_tcp_recv(sockfd, timeout);
```

Input:

- sockfd - a socket file descriptor which is an integer.
- timeout - a millisecond timer. It's an optional argument. It must be an positive integer or zero (timeout immediately). Omit means never timeout.

Return value:

- Received data will be returned on success.
- If *timeout* >= 0 and no data arrived, *nil* will be returned.
- If TCP closed, *true* will be returned.
- Otherwise *false* returned.



##### mln_tcp_close

Close a TCP connection.

```
@mln_tcp_close(sockfd);
```

Input:

- sockfd - a socket file descriptor which is an integer.

Return value:

- Always *nil*.



##### mln_tcp_shutdown

Shutdown TCP connection.

```
@mln_tcp_shutdown(sockfd, mode);
```

Input:

- sockfd - a socket file descriptor which is an integer.
- mode - a string and only has two values: *send* and *recv*.

Return value:

- Always *nil*.



##### mln_udp_create

Create an UDP socket.

```
@mln_udp_create(host, service);
```

Input:

- host - a string value. It can be an IP or domain name.
- service -  a string value. It can be a port number or protocol name, like: http, 80.

Return value:

- a TCP socket file descriptor return on success, otherwise *false* returned.



##### mln_udp_close

Close an UDP socket.

```
@mln_udp_close(fd);
```

Input:

- fd - an UDP socket file descriptor generated by *mln_udp_create*.

Return value:

- Always *nil*.



##### mln_udp_send

Send data via UDP.

```
@mln_udp_send(fd, data, host, service);
```

Input:

- fd. - an UDP socket file descriptor generated by *mln_udp_create*.
- data - a string value.
- host - a string value. It can be an IP or domain name. This is the destination host.
- service - a string value. It can be a port number or protocol name, like: http, 80. This is the destination service name.

Return value:

- *true* will be returned on success, otherwise *false* returned.



##### mln_udp_recv

Receive data from UDP.

```
@mln_udp_recv(fd, bufsize, &ip, &port, timeout);
```

Input:

- fd - an UDP socket file descriptor generated by *mln_udp_create*.
- bufsize - an integer indicates the UDP receiving buffer size.
- ip - sender's IP. **This is an output argument**.
- port - sender's port. **This is an output argument**.
- timeout - a millisecond timer. It's an optional argument. It must be an positive integer or zero (timeout immediately). Omit means never timeout.

Return value:

- Received data will be returned on success.
- If *timeout* >= 0 and no data arrived, *nil* will be returned.
- Otherwise *false* returned.



##### Example

```
//client.mln
fd = @mln_tcp_connect('127.0.0.1', '1234');
@mln_print(fd);
@mln_tcp_send(fd, 'Hello');
@mln_print(@mln_tcp_recv(fd));
@mln_tcp_close(fd);
```

```
//server.mln
listenfd = @mln_tcp_listen('127.0.0.1', '1234');
connfd = @mln_tcp_accept(listenfd);
@mln_print(@mln_tcp_recv(connfd));
@mln_tcp_send(connfd, 'Hi');
@mln_tcp_close(connfd);
```

```
$ melang server.mln client.mln
```

The output is:

```
10
Hello
Hi
```

